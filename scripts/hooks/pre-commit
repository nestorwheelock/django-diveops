#!/bin/bash
# Prevent AI attribution in staged files
# Install: cp scripts/hooks/* .git/hooks/ && chmod +x .git/hooks/*

# Check staged files for forbidden patterns
FORBIDDEN_PATTERNS=(
    "Generated with Claude"
    "Co-Authored-By: Claude"
    "Built with Claude"
    "Claude Code"
)

# Get list of staged files (excluding binary files and CLAUDE.md which documents the rules)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(py|rs|kt|java|js|ts|md|txt|yml|yaml|toml|json)$' | grep -v 'CLAUDE.md')

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

FOUND_VIOLATION=0

for file in $STAGED_FILES; do
    for pattern in "${FORBIDDEN_PATTERNS[@]}"; do
        if git show ":$file" 2>/dev/null | grep -i "$pattern" > /dev/null 2>&1; then
            echo "ERROR: File '$file' contains forbidden AI attribution: $pattern"
            FOUND_VIOLATION=1
        fi
    done
done

if [ $FOUND_VIOLATION -eq 1 ]; then
    echo ""
    echo "AI attribution is not allowed in this repository."
    echo "Please remove any references to Claude, AI assistants, or Anthropic."
    exit 1
fi

exit 0
